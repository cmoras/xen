import os
import re

import glob
import re


from subprocess import PIPE, Popen

flag=0

for i in os.get_exec_path():
	os.chdir(i)
	list=os.listdir()
	for j in list:
		if flag == 1:
			break;
		if re.search(r'xl$', j):
			XL=os.path.join(i,"xl")
			FLAG=1
		elif re.search(r'xm$', j):
			XM=os.path.join(i, "xm")
			FLAG=1
##
##the first section of identifying which of  xl or xm is being used completes here.
##

#startig with the main program

import argparse


parser = argparse.ArgumentParser()
parser.add_argument('-x', '--show_vmnames', help='List of vmnames along with hostnames', action='store_value')
parser.add_argument('-a', '--show_pooldetails', help='Check current details wrt cpu', action='store_true')
parser.add_argument('-s', '--set_pool', help='create new pool as per NUMA acrchitecture' action='store_true')

args=parser.parse_args()


def cfg_parse(i):
	with open(i) as file:
		for line in file:
			line = line.strip()
			[hm.append(match) for match in re.findall(r'host.*', line)]
			[hm.append(match) for match in re.findall(r'memory.*', line)]
			[hm.append(match) for match in re.findall(r'^disk.*', line)]
			[hm.append(match) for match in re.findall(r'^cpu.*', line)]
			[hm.append(match) for match in re.findall(r'^name.*', line)]
			[hm.append(match) for match in re.findall(r'^vcpu.*', line)]
			hm.append("\n")
	print(hm)




if (args.show_vmnames):
	condition=0
	print("[+] Available vm on the system under xen are")
	os.chdir('/home/xen')
	list0=os.listdir(os.getcwd())
	for i in list0:
		print(i, end=" ")
	print("[+] Do you more details on vm ?")
	print("[+] Type Y/y to proceed and N/n to exit out of this loop")
#condition here need to be thought out 
	while True:
		choice=input("your choice : ")
		if (choice=="y") or (choice=='Y'):
			print("[+]Proceeding. Do you want deatisl of a particular vm or all of the vm's")
			print("[+] if one vm, then enter the /vmname/, else type /all/")
			choice_vm_all=input("your choice : ")
			if choice_vm_all == "all":
				hm=[]
				for i in glob.glob('**/*.cfg', recursive=True):
					#        with open(i) as file:
				        #        for line in file:
				        #                line = line.strip()
				        #                [hm.append(match) for match in re.findall(r'host.*', line)]
				        #                [hm.append(match) for match in re.findall(r'memory.*', line)]
				        #                [hm.append(match) for match in re.findall(r'^disk.*', line)]
					#        hm.append("\n")
					#print(hm)
				cfg_parse(i)
			else:
				vmname=raw_input("Eneter the vm number that you want more etails of")
				match_choice_vm_all=re.search(r'^vm.*', vmname) 
				print(f"[+] getting details of {match_choice_vm_all}"
				cfg_parse(i)
		else:
			break; 
			#maybe even break 2 <-- this needs to be tested.



